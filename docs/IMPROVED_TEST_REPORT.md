# グラニュート文字OCR 改善テストレポート

## 改善内容

### 1. CNNモデルの統合
- **実装内容**: 95%精度のCNNモデルを主要認識手法として統合
- **モデルパス**: `models/cnn_model_best.pth`
- **アーキテクチャ**: 4層CNN with BatchNorm and Dropout

### 2. 前処理パイプラインの改善
- **文字の太さ正規化**: モルフォロジー変換で細い線を太くする
- **コントラスト強化**: 二値化とガウシアンブラーの組み合わせ
- **リサイズ処理**: 48x48以上にスケールアップしてから処理

### 3. 認識手法の最適化
- **CNN優先度**: 信頼度0.8以上で確定、0.5-0.8で条件付き採用
- **Tesseract活用**: L, P, Rなど特定文字で優先使用
- **Hash-basedフォールバック**: 他の手法が失敗した場合のみ使用

## テスト結果

### 初期状態
- **テスト画像**: test_data/test.png
- **実際の文字列**: PLEASURE
- **初期認識結果**: BDEPQYYZ (12.5%精度 - 1/8文字正解)

### 改善後
- **認識結果**: PLEPSUZ (62.5%精度 - 5/8文字正解)
- **処理時間**: 0.197秒
- **文字分割**: 8文字（正確）✓

### 詳細結果
| 位置 | 期待 | 認識 | 手法 | 信頼度 | 正解 |
|------|------|------|------|--------|------|
| 1 | P | P | Tesseract | 0.70 | ✓ |
| 2 | L | L | Tesseract | 0.70 | ✓ |
| 3 | E | E | CNN | 0.64 | ✓ |
| 4 | A | P | Tesseract | 0.70 | ✗ |
| 5 | S | S | CNN | 0.97 | ✓ |
| 6 | U | U | CNN | 0.86 | ✓ |
| 7 | R | P | Tesseract | 0.70 | ✗ |
| 8 | E | Z | CNN | 0.60 | ✗ |

### 認識手法の内訳
- CNN: 4文字使用（3文字正解）
- Tesseract: 4文字使用（2文字正解）
- Hash-based: 0文字使用

## 成果と残課題

### 成果
1. **認識精度の大幅改善**: 12.5% → 62.5%（5倍向上）
2. **CNNモデルの統合成功**: 高信頼度の文字で高精度
3. **Tesseractの有効活用**: P, Lなど特定文字で効果的
4. **処理時間の維持**: 200ms以内で実用的速度

### 残課題
1. **文字スタイルの違い**
   - 訓練データ: 紫バブル内の太い文字
   - テスト画像: 通常のグラニュート文字（細い線）
   - この違いがCNNの精度低下の主因

2. **誤認識パターン**
   - A → P: 形状の類似性による誤認識
   - R → P: Tesseractの学習データ不足
   - E → Z: CNNの信頼度が中程度での誤認識

3. **Hash-based手法の精度**
   - 現在は最終手段として使用
   - より良いハッシュアルゴリズムの検討が必要

## 今後の改善提案

### 短期的改善
1. **文字別閾値調整**: A, R, Eなど誤認識しやすい文字の個別対応
2. **アンサンブル手法**: 複数手法の投票による決定
3. **後処理**: 文脈を考慮した修正（辞書ベース）

### 長期的改善
1. **実画像での再訓練**
   - テスト画像と同じスタイルのデータ収集
   - CNNモデルの再訓練で95%以上の精度を目指す

2. **End-to-Endモデル**
   - 文字分割と認識を同時に行うモデル
   - Transformer系のモデルも検討

3. **リアルタイム最適化**
   - モデルの軽量化
   - GPU活用による高速化

## 結論
改善により認識精度は5倍向上しましたが、実用レベル（85%以上）にはまだ改善が必要です。特に、実際のグラニュート文字画像での再訓練が最も効果的な改善策と考えられます。